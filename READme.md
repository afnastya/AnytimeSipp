# Sipp

В этом репозитории есть реализация алгоритма планирования траектории в среде с динамическими препятствиями Sipp, визуализатор работы алгоритма. Реализация протестирована на большой выборке тестов, сгенерированных рандомно. Результаты тестирования также доступны в репозитории.

## Contents

* [Алгоритм Sipp](#алгоритм-sipp)
* [Чекер](#чекер)
* [Визулизация](#визулизация)
* [Тестирование и его результаты](#тестирование-и-его-результаты)

## Алгоритм Sipp
### Сборка:
```bash
mkdir Build
cd build
cmake ..
make SippSearch
```

### Запуск:
Находимся в директории Build.
```bash
./Src/Planning/SippSearch input.xml [logLevel]
```
В аргументах командной строки нужно передать путь от Build до xml-файла с заданием либо до директории с заданиями (тогда сразу протестируются все задания из этой директории). Опционально, последним аргументом можно передать уровень логирования (logLevel):
- -1 - в консоль ничего не выведится
- 0 - только путь до файла с заданием или пути, если был передан путь до директории
- 1 - выведутся результаты (основные показатели: pathlength, nodescreated, numberofsteps, searchtime)
- 2 - всё, что в предыдущих, а также слова, сигнализирующие о конце какого-то этапа работы программы
- 3 - всё, что в предыдущих, а также на каждом шаге алгоритма будут выводиться параметры текущего node и списки безопасных интервалов его successors
## Генерация тестов
### Сборка и запуск
Находимся в директории Build

Сборка:
```bash
make Generate
```
Запуск:
```bash
./Tests/Generate maps_directory tasks_directory a_1 a_2 a_3 ... a_n
```
Для каждой карты из директории maps_directory генерирует по 5 тестов с a_i количеством динамических препятствий, все тесты кладет в директорию tasks_directory. Здесь карта - это файл, строго соблюдающий следующий формат:
```txt
type octile
height 4
width 5
map
...11
...11
11.11
11...
```
После слов height и width положительные числа, равные высоте и ширине карты соответственно. После строки "map" идет описание карты: количество строк равно высоте карты, количество символов в каждой строке ровно ширине карты. Символ '.' означает пустую клетку, любой другой непробельный символ - занятая клетка.

#### Пример
Тесты на городских картах размера 256x256 с маленьким числом динамических препятствий(10, 20, 50, 100 и 200), лежащие в [папке](TestsData/City/tests_256/small_tasks/tasks), были сгенерированы следующей командой:
```bash
./Tests/Generate ../TestsData/City/tests_256/maps/ ../TestsData/City/tests_256/small_tasks/tasks/ 10 20 50 100 200
```
## Чекер
```bash
make Check
./Tests/Check logs_directory
```
## Визулизация
```bash
Python3 ../Src/Visualization/visualize.py log_file.xml
```
log_file.xml - файл, полученный работой Sipp

## Тестирование и его результаты
Были сгенерированы тесты на картах размеров 256x256, 512x512 и 1024x1024 (по 30 карт каждого размера), для каждой из карт было сгенерировано задание с 10, 20, 50, 100, 200, 500, 1000 динамических препятствий (по 5 тестов для каждой конфигурации). Итого получилось 3150 тестов.
Результаты тестирования оформлены в качестве таблиц и графиков в [ноутбуке](Tests/analysis.ipynb).

Запустить алгоритм поиска пути sipp и чекер, проверяющий полученный результат на всех 3150 заданиях, лежащих в репозитории, можно следующей командой:
```bash
ctest -R 'run'
```
Результат работы будет примерно таким:
```bash
Test project
      Start  1: preparation/run
 1/10 Test  #1: preparation/run ..................   Passed    0.02 sec
      Start  2: 256/small_tasks/run
 2/10 Test  #2: 256/small_tasks/run ..............   Passed  262.34 sec
      Start  3: 256/tasks_500/run
 3/10 Test  #3: 256/tasks_500/run ................   Passed  249.58 sec
      Start  4: 256/tasks_1000/run
 4/10 Test  #4: 256/tasks_1000/run ...............   Passed  504.36 sec
      Start  5: 512/small_tasks/run
 5/10 Test  #5: 512/small_tasks/run ..............   Passed  879.75 sec
      Start  6: 512/tasks_500/run
 6/10 Test  #6: 512/tasks_500/run ................   Passed  791.28 sec
      Start  7: 512/tasks_1000/run
 7/10 Test  #7: 512/tasks_1000/run ...............   Passed  1551.10 sec
      Start  8: 1024/small_tasks/run
 8/10 Test  #8: 1024/small_tasks/run .............   Passed  3435.26 sec
      Start  9: 1024/tasks_500/run
 9/10 Test  #9: 1024/tasks_500/run ...............   Passed  3229.97 sec
      Start 10: 1024/tasks_1000/run
10/10 Test #10: 1024/tasks_1000/run ..............   Passed  6025.65 sec

100% tests passed, 0 tests failed out of 10

Total Test time (real) = 16929.35 sec
```
Команды, выполняющиеся в каждом тесте, можно посмотреть [здесь](/Tests/CMakeLists.txt).
Обратите внимание на время тестирования! Из-за большого числа тестов (3150) оно довольно большое. Если не хочется ждать, можно запустить меньшее число тестов, заменив 'run' на часть имени или полное имя теста. Например, прогоним один блок тестов, где проверим работу на картах 256x256 c маленьким числом динамических препятствий (до 200), то есть программа будет запущена всего на 750 заданиях, а время работы этого блока тестов не более 5 минут:
```bash
ctest -R '256/small_tasks/run'
```

Либо, если не хочется ждать, можно запустить блоки тестов, в которых не планируются траектории, а только запускается чекер, проверяющий уже полученные мной результаты работы алгоритма, лежащие в репозитории. Здесь проверяется, что все полученные пути агентов записаны в правильном виде, действительно начинаются и заканчиваются в клетках старта и финиша соответственно, а также не пересекают ни статические, ни динамические препятствия.```bash
ctest -R 'check'
```

В консоли видим примерно такой результат:
```bash
Test project
    Start 11: 256/small_tasks/check
1/9 Test #11: 256/small_tasks/check ............   Passed   20.78 sec
    Start 12: 256/tasks_500/check
2/9 Test #12: 256/tasks_500/check ..............   Passed   17.12 sec
    Start 13: 256/tasks_1000/check
3/9 Test #13: 256/tasks_1000/check .............   Passed   39.78 sec
    Start 14: 512/small_tasks/check
4/9 Test #14: 512/small_tasks/check ............   Passed   49.89 sec
    Start 15: 512/tasks_500/check
5/9 Test #15: 512/tasks_500/check ..............   Passed   27.52 sec
    Start 16: 512/tasks_1000/check
6/9 Test #16: 512/tasks_1000/check .............   Passed   53.43 sec
    Start 17: 1024/small_tasks/check
7/9 Test #17: 1024/small_tasks/check ...........   Passed  163.67 sec
    Start 18: 1024/tasks_500/check
8/9 Test #18: 1024/tasks_500/check .............   Passed   59.60 sec
    Start 19: 1024/tasks_1000/check
9/9 Test #19: 1024/tasks_1000/check ............   Passed   93.41 sec

100% tests passed, 0 tests failed out of 9

Total Test time (real) = 525.22 sec
```